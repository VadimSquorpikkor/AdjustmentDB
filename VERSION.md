# AdjustmentDB   

* <b>1.31 - 12/04/21</b>
1. MultiScanFragmentNew теперь не работает со сканером напрямую, а получает и передает данные через viewModel (пока не доконца отвязал фрагмент от логики, но в будущем всё будет по MVVM)
2. Рефакторинг
* <b>1.30 - 12/04/21</b>
1. Теперь из БД загружается не только список имен статусов, а ещё и список идентификаторов статусов. В БД сохраняются не имена статусов, а их идентификаторы
2. Лисенер для имен статусов (и ремонтный, и серийный) теперь передает в dbh два листа — для имен статусов и идентификаторов статусов
3. Переписан Scanner, теперь он отвязан от view и работает только с viewModel (через интерфейс). 
5. SingleScanFragmentNew теперь не работает со сканером напрямую, а получает и передает данные через viewModel (пока не доконца отвязал фрагмент от логики, но в будущем всё будет по MVVM)
4. Всё-таки отказался от словаря на TreeMap — вместо него 2 отдельный ArrayList, так удобнее и понятнее 
* <b>1.29 - 11/04/21</b>
1. Переписан Scanner и SingleScanFragment
* <b>1.28 - 08/04/21</b>
1. Глобальное обновление: переделана БД: переименованы таблицы: states -> events, users -> employees, dev_types -> devices, profiles -> states — наведен порядок в терминах, устранена путаница в названиях; таблицы repairs и serials объеденены в одну таблицу units. Переименованы поля, которые ссылаются на другие таблицы (location -> location_id). Во все таблицы кроме events добавлено поле id. Имя документа теперь совпадает с id этого документа (можно искать и по id, как и раньше, а можно просто брать документ по его названию, в абстракции имя документа есть его id, как если бы БД была не NoSQL, а SQL). Ещё: теперь все таблицы в БД не хранят значения из других таблиц, а хранят ссылки (id) на эти значения, т.е. приведены к какой-то там по счету форме. Переименование значений или добавление локализации больше не будет головной болью и костылями, всё решается теперь просто.
2. Соответственно переделано преложение под новую БД
3. Поиск устройства по его id теперь возвращает не список, а устройство (DUnit)
4. Удален класс DevType. Вместо него просто получаю из БД список стрингов
5. Отказался от конвертеров firebase, кода чуть больше, но более гибкий, что хочу, то и делаю 
* <b>1.27 - 05/04/21</b>
1. Глобальное обновление. Переделан интерфейс: теперь представляет собой ViewPager на 3 страницы вместе с TabLayout — одиночное сканирование, множественное сканирование и поиск устройства. Переключение между страницами свайпом
2. Убраны списки серийных и ремонтных устройств, теперь они НЕ БУДУТ отображаться, это не нужно. Вместо списков будет фильтр (страница "Поиск Устройства"), с помощью которого можно будет найти устройство в БД
3. В заголовках закладок отображается текст и иконка
4. Начал рисовать фильтр
* <b>1.26 - 02/04/21</b> (Версия не обновлялась)
1. Firebase user перенесен в viewModel. Теперь при при сиене фрагментов / ориентации не происходит перерегистрация
* <b>1.26 - 01/04/21</b>
1. В БД добавлена коллекция юзеров. Каждому юзеру соответствует его email (Google аккаунт) и конкретный профиль (локация, т.е. его юзера участок)
2. Добавлена коллеция локаций, теперь названия локаций хранится в БД, при добавлении / изменении локаций они автоматом изменятся на всех устройствах (пока после перезагрузки, потом добавлю лисенер) 
3. Добавлена авторизация по Google аккаунту. При запуске прогграммы приложение запрашивает в БД профиль, который соответствует этому аккаунту. Таким образом для каждого юзера будет доступный ему набор статусов, а значит юзер с регулировки не сможет добавить статус монтажа
4. На главном экране вверху теперь отображается email аккаунта и название локации
5. Удален enum Profile. Теперь профилей на устройстве нет, текущий профиль грузится из БД по имени аккаунта
6. Исправлена ошибка ViewModel: во фрагментах в конструкторе модели стоял this вместо getActivity, поэтому при открытии нового фрагмента модель создавалась заново (3 часа поиска причины, почему успешно загруженный лист данных при открытии диалога сбрасывался в null)
* <b>1.25 - 31/03/21</b>
1. Для DUnit добавлен параметр location (на каком участке находится) 
2. Реализована загрузка доступных статусов в зависиммости от выбранного профиля: от локации и от типа (ремонт/серия). Если статус "any" (одинаковый и для ремонта и для серии), то будет загружаться для любого типа  
* <b>1.24 - 31/03/21</b>
1. В БД переделана коллекция профилей. Была коллекция с вложенными в неё коллекциями статусов для каждого типа профиля (локации): profiles->adjustment_states->repair_states->s1. Теперь все статусы располагаются вместе в одной коллекции: profiles->s1 , каждый статус получил дополнительные поля "location" и "type". Теперь вся БД приведена к Нормальной Форме
2. Соответственно переделаны методы и лисенеры для работы с профилями и статусами 
* <b>1.23 - 30/03/21</b>
1. Глобально переделана БД. Вместо вложенных в каждый unit списков статусов теперь для ВСЕХ статусов используется ОДНА коллекция, выбор статусов для каждого юнита происходит по полю "unit_id", в которое при создании статуса заносится id текущего устройства
2. Удалены из БД коллекции "repair_states", "serial_states", коллекция "units" переименована в "serials"
3. Соответственно глобально переделаны методы для работы с изменившейся БД
4. Глобально переделаны методы в MainViewModel и FireDBHelper. Упрощено, сокращено, переделано
* <b>1.22 - 29/03/21</b>
1. Добавлены профили — монтаж, сборка, регулировка, приемка, градуировка.
2. Переделана архитектура: теперь вместо 2-х списков статусов (серия, ремонт) используется несколько списков, в зависимости от выбранного профиля. Так, если выбран профиль "Регулировка", то список статусов выбирается, как dbh.addStringArrayListener(<таблица_профилей>, <имя_документа_в_таблице_профилей>, <таблица_ремонт_или_серия>, <список_для_результата>, <имя_параметра>). Таким образом список статусов (при выборе в диалоге, например) зависит от выбранного профиля и от типа (серия или ремонт)
3. Диалог выбора статуса изменен: вместо списка теперь Спинер, а поле ввода убрано вообще — это была ошибка, так можно было добавить новый статус, который НЕЛЬЗЯ было бы выбрать в фильтре статусов — ведь список для фильтров формируется на основе списка статусов из БД
4. Для статуса теперь можно ещё добавить какое-либо описание (в произвольной форме)
5. Главный итог: теперь вместо списка статусов(на монтаже, на регулировке, кто-то взял...) список профилей (регулировка, сборка, градуировка...), у каждого профиля свой список статусов (диагностика, испытания, ...), также у некоторых профилей статусы различаются в зависимости ремонт это или серия  
* <b>1.21 - 26/03/21</b>
1. Добавлен звуковой сигнал при успешном распознании QR-кода
2. Доработан алгоритм распознования сразу нескольких QR-кодов — теперь распознаются сразу несколько, при наведении сразу на несколько кодов бывает распознаются сразу все 
* <b>1.20 - 25/03/21</b>
1. Переделана логика обработки строки, полученной от сканера
2. Добавлен режим распознования нескольких кодов подряд. Если навести камеру при включенном "Авто" режиме сразу на несколько QR-кодов, сканер распознает ВСЕ коды и занесет полученные юниты в коллекцию. Рукой даже не нужно будет двигать, все попавшие в экран коды будут поочередно распознаны, при этом БЕЗ повторных распознований
3. Количество распознанных устройств отображается в углу экрана
4. При каждом новом обнаруженном устройстве выводится новый пункт в списке найденных устройств
* <b>1.19 - 24/03/21</b>
1. ScannerFragment разделен на 2 класса ScannerFragment и Scanner. Теперь Scanner занимается конкретно сканированием QR-кода, парсингом и дешифровкой полученной строки. Классы сканирования и дешифровки закинул в отдельный package
* <b>1.18 - 23/03/21</b>
1. Вывод статусов в хронологическом порядке
* <b>1.17 - 23/03/21</b>
1. Добавлен значок в приложение
2. В DUnit добавлено поле "type", которое определяет, ремонтный блок или серийный. Вся логика переделана под использование getType, раньше для этого использовалось отдельное поле в viewModel
* <b>1.16 - 23/03/21</b> (Версия не обновлялась)
1. Нарисовал логотип (он же значок). PNG и PSD
* <b>1.16 - 22/03/21</b> (Версия не обновлялась)
1. Добавил описание в ReadMe.md
2. По-мелочи
* <b>1.16 - 21/03/21</b>
1. Добавлен лисенер для списка категорий текущего блока: при добавлении нового статуса через диалог этот статус НЕМЕДЛЕННО добавляется в списке статусов блока (точнее: при нажатии на "ОК" статус сохраняется в БД, сразу же после этого срабатывает лисенер, отслеживающий изменения в таблице статусов текущего блока и эти изменения сразу же загружаются в приложение)
* <b>1.15 - 21/03/21</b>
1. Переделан фрагмент сканирования часть 2.
2. Переделана логика распознавания: теперь открывается окно сканирования, если код распознан, то показывается лэйаут с информацией по устройству. Если у устройства есть статусы, то будет отображаться список всех статусов этого устройства. Снизу лэйаута находится кнопка, при нажатии на которую открывается диалог со списком доступных статусов (для ремонтного и серийного устройства различаются), из которого можно добавить новый статус для устройства. Вверху диалога есть EditText, в нем отображается выбранный статус, при необходимости можно вручную набрать свой статус. При нажатии "ОК" устройство с обновленными данными сохраняется в БД
* <b>1.14 - 19/03/21</b>
1. Переделан фрагмент сканирования.
2. При успешном распознании QR-кода выводится таблица статусов текущего устройства
3. Добавлен метод загрузки статуса текущего устройства (коллекция в коллекции). Создан адаптер для статусов
* <b>1.13 - 18/03/21</b>
1. На страницу сканнера добавлен список приборов. Соответствующие лисенеры и адаптеры. (С главной убрал). Данные из БД
2. Добавлены спиннеры: для выбора статуса ремонтных и для выбора статуса серийных приборов. Оба спиннера получают данные в реальном времени из базы данных
3. В зависимости оттипа прибора, ремонт или серия, отображается соответствующий спиннер
* <b>1.12 - 17/03/21</b>
1. На главную страницу добавлен список ремонтных приборов. Соответствующие лисенеры и адаптеры.
2. Для переключения между списками (серия и ремонт) добавлены табы
3. Добавлено отображение номера версии. Заменен значек камеры
* <b>1.11 - 09/03/21</b>
1. Добавлены методы для работы с ремонтными устройствами. При сканировании определяется: ремонт или серия и выполняются методы по ситуации
2. В DUnit добавлен String id, добвлены соответствующие методы  
3. В БД добавлена новая таблица: для ремонтных устройств. Теперь приложение выбирает, с какой из таблиц работать: с серией или с ремонтом
4. Добавлен Mutable для статуса ремонт или серия   
* <b>1.10 - 04/03/21</b>
1. Добавлено: так как теперь строка в QR-коде будет закодированной (в генератор добавлен кодировщик, см. папку "qrscanner" в AdjustmentWeb), то теперь в приложении при считывании строки сразу же запускается процесс дешифровки (класс Encrypter)
* <b>1.09 - 26/02/21</b>
1. Изменена кнопка добавления в БД — теперь большая оранжевая с закругленными углами. Надпись на кнопки меняется: "Нет данных", "Добавить в БД", "Обновить данные в БД"
2. Надпись при распознавании уменьшена и перемещена в угол
* <b>1.08 - 26/02/21</b>
1. Для FireDBHelper конструктор переделан в конструктор без параметров, Mutable передается методам в классе FireDBHelper как параметр
2. Переделан метод загрузки в БД (addElementToDB): теперь, если документ не существует, он будет создан, если документ существует, его содержимое будет перезаписано вновь предоставленными данными
3. При успешном сканировании qr-кода отправляется запрос в БД на наличие такого устройства в БД (по имени и внутреннему серийнику), и, если оно найдено в форму загружаются данные из БД для этого устройства.
4. В список статусов добавлен "-- не выбрано --", который отображается по умолчанию, если он выбран, поле статуса пустое будет пустым 
* <b>1.07 - 26/02/21</b>
1. Добавил ReadMe.md и Version.md
2. Добавил Спиннер для выбора статуса прибора (на линейке, на сборке) и соответствующий лисенер, адаптер и массив данных. При выборе значения в спинере, это значение вставляется в поле данных
3. В DUnit добавлен внутренний серийник и статус, в адаптеры и лэйауты добавлены соответстыующие поля
4. В фрагменте сканнера добавлены поясняющие надписи, новые поля ввода; поля сделаны неактивными; добавлена кнопка включения/выключения режима редактирования полей ввода
5. Приложение теперь в темной теме и без ActionBar
* <b>1.06 - 24/02/21</b>
1. Вывод результата распознавания на SurfaceView
* <b>1.05 - 22/02/21</b>
1. Немного навел порядок
* <b>1.04 - 22/02/21</b>
1. Сделал парсер, окно сканнера и добавление в БД теперь в отдельном фрагменте 
* <b>1.03 - 22/02/21</b>
1. Добавлен фрагмент с QR-сканером. Сканирует QR-код и получает стринг, потом сделаю парсер
* <b>1.02 - 22/02/21</b>
1. Добавлен RecyclerView со всеми холдерами и адаптерами
2. При старте RecyclerView заполняется данными с БД, при добавлении данных в БД НЕ ИЗ ТЕКУЩЕГО ПРИЛОЖЕНИЯ RecyclerView приложение автоматически загружает данные с БД и обновляет RecyclerView (срабатывает лисенер)
* <b>1.01 - 21/02/21</b>
1. Добавлен лисенер изменений в FireStorage БД. При изменениях запускается загрузка данных
2. Данные храняться как Mutable<ArrayList<DUnit>>
